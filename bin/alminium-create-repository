#!/bin/sh

if [ -f /etc/debian_version ]
then
    OS='debian'
    APACHE_USER=www-data
elif [ -f /etc/redhat-release ]
then
   OS='rhel'
   APACHE_USER=apache
fi

ALMINIUM_VAR=/var/opt/alminium
ALMINIUM_HOME=/opt/alminium

if [ $# != 2 ]
then
    echo "これはバージョン管理のリポジトリを作成するコマンドです。"
    echo "usage: alminium-create-erepository <リポジトリタイプ> <リポジトリ名>"
    echo ""
    echo "リポジトリタイプはsvn,git,hgを利用できます"
    exit 
fi

TYPE=$1
NAME=$2


if [ $TYPE = 'svn' ]
then
    svnadmin create $ALMINIUM_VAR/svn/$NAME
    cp $ALMINIUM_HOME/hooks/svn/post-commit $ALMINIUM_VAR/svn/$NAME/hooks/
    chmod a+x $ALMINIUM_VAR/svn/$NAME/hooks/post-commit
    chown $APACHE_USER.$APACHE_USER -R $ALMINIUM_VAR/svn/$NAME

fi
if [ $TYPE = 'git' ]
then
    git init --bare $ALMINIUM_VAR/git/$NAME
    git --git-dir=$ALMINIUM_VAR/git/$NAME update-server-info  
    cp $ALMINIUM_HOME/hooks/git/post-receive $ALMINIUM_VAR/git/$NAME/hooks/
    chmod a+x $ALMINIUM_VAR/git/$NAME/hooks/post-receive
    chown $APACHE_USER.$APACHE_USER -R $ALMINIUM_VAR/git/$NAME
if [ $TYPE = 'hg' ]
then
     hg init $KANON_VAR/hg/$PROJECT_NAME
     chown $APACHE_USER.$APACHE_USER -R $ALMINIUM_VAR/hg/$NAME
fi